sap.ui.define(["sap/ui/test/Opa5","sap/ui/test/actions/Press","./Common","sap/ui/test/actions/EnterText","sap/ui/test/matchers/AggregationLengthEquals","sap/ui/test/matchers/AggregationFilled","sap/ui/test/matchers/PropertyStrictEquals"],function(e,t,i,s,r,n,o){"use strict";var a="Master",u="*#-Q@@||";e.createPageObjects({onTheMasterPage:{baseClass:i,actions:{iSortTheListOnName:function(){return this.iChooseASorter("sortButton","Sort By <ProductName>")},iSortTheListOnUnitNumber:function(){return this.iChooseASorter("sortButton","Sort By <UnitPrice>")},iFilterTheListOnUnitNumber:function(){return this.iMakeASelection("filterButton","<UnitPrice>","<100 ")},iGroupTheList:function(){return this.iChooseASorter("groupButton","<UnitPrice> Group")},iRemoveListGrouping:function(){return this.iChooseASorter("groupButton","None")},iOpenViewSettingsDialog:function(){return this.waitFor({id:"filterButton",viewName:a,actions:new t,errorMessage:"Did not find the 'filter' button."})},iPressOKInViewSelectionDialog:function(){return this.waitFor({searchOpenDialogs:true,controlType:"sap.m.Button",matchers:new e.matchers.PropertyStrictEquals({name:"text",value:"OK"}),actions:new t,errorMessage:"Did not find the ViewSettingDialog's 'OK' button."})},iPressResetInViewSelectionDialog:function(){return this.waitFor({searchOpenDialogs:true,controlType:"sap.m.Button",matchers:new e.matchers.PropertyStrictEquals({name:"icon",value:"sap-icon://clear-filter"}),actions:new t,errorMessage:"Did not find the ViewSettingDialog's 'Reset' button."})},iMakeASelection:function(e,i,s){return this.waitFor({id:e,viewName:a,actions:new t,success:function(){this.waitFor({controlType:"sap.m.StandardListItem",matchers:new o({name:"title",value:i}),searchOpenDialogs:true,actions:new t,success:function(){this.waitFor({controlType:"sap.m.StandardListItem",matchers:new o({name:"title",value:s}),searchOpenDialogs:true,actions:new t,success:function(){this.waitFor({controlType:"sap.m.Button",matchers:new o({name:"text",value:"OK"}),searchOpenDialogs:true,actions:new t,errorMessage:"The ok button in the dialog was not found and could not be pressed"})},errorMessage:"Did not find the"+s+"in"+i})},errorMessage:"Did not find the "+i+" element in select"})},errorMessage:"Did not find the "+e+" select"})},iRememberTheSelectedItem:function(){return this.waitFor({id:"list",viewName:a,matchers:function(e){return e.getSelectedItem()},success:function(e){this.iRememberTheListItem(e)},errorMessage:"The list does not have a selected item so nothing can be remembered"})},iChooseASorter:function(e,i){return this.waitFor({id:e,viewName:a,actions:new t,success:function(){this.waitFor({controlType:"sap.m.StandardListItem",matchers:new o({name:"title",value:i}),searchOpenDialogs:true,actions:new t,success:function(){this.waitFor({controlType:"sap.m.Button",matchers:new o({name:"text",value:"OK"}),searchOpenDialogs:true,actions:new t,errorMessage:"The ok button in the dialog was not found and could not be pressed"})},errorMessage:"Did not find the"+i+" element in select"})},errorMessage:"Did not find the "+e+" select"})},iRememberTheIdOfListItemAtPosition:function(e){return this.waitFor({id:"list",viewName:a,matchers:function(t){return t.getItems()[e]},success:function(e){this.iRememberTheListItem(e)},errorMessage:"The list does not have an item at the index "+e})},iRememberAnIdOfAnObjectThatsNotInTheList:function(){return this.waitFor(this.createAWaitForAnEntitySet({entitySet:"Products",success:function(e){this.waitFor({id:"list",viewName:a,matchers:new n({name:"items"}),success:function(t){var i,s=e.filter(function(e){return!t.getItems().some(function(t){return t.getBindingContext().getProperty("ProductID")===e.ProductID})});if(!s.length){i=e[e.length-1].ProductID}else{i=s[0].ProductID}var r=this.getContext().currentItem;r.bindingPath="/"+t.getModel().createKey("Products",{ProductID:i});r.id=i},errorMessage:"the model does not have a item that is not in the list"})}}))},iPressOnTheObjectAtPosition:function(e){return this.waitFor({id:"list",viewName:a,matchers:function(t){return t.getItems()[e]},actions:new t,errorMessage:"List 'list' in view '"+a+"' does not contain an ObjectListItem at position '"+e+"'"})},iSearchForTheFirstObject:function(){var e;return this.waitFor({id:"list",viewName:a,matchers:new n({name:"items"}),success:function(i){e=i.getItems()[0].getTitle();return this.iSearchForValue(new s({text:e}),new t)},errorMessage:"Did not find list items while trying to search for the first item."})},iTypeSomethingInTheSearchThatCannotBeFoundAndTriggerRefresh:function(){return this.iSearchForValue(function(e){e.setValue(u);e.fireSearch({refreshButtonPressed:true})})},iSearchForValue:function(e){return this.waitFor({id:"searchField",viewName:a,actions:e,errorMessage:"Failed to find search field in Master view.'"})},iClearTheSearch:function(){var e=function(e){e.clear()};return this.iSearchForValue([e])},iSearchForSomethingWithNoResults:function(){return this.iSearchForValue([new s({text:u}),new t])},iRememberTheListItem:function(e){var t=e.getBindingContext();this.getContext().currentItem={bindingPath:t.getPath(),id:t.getProperty("ProductID"),title:t.getProperty("ProductName")}}},assertions:{iShouldSeeTheBusyIndicator:function(){return this.waitFor({id:"list",viewName:a,matchers:new o({name:"busy",value:true}),autoWait:false,success:function(){e.assert.ok(true,"The master list is busy")},errorMessage:"The master list is not busy."})},theListShouldContainAGroupHeader:function(){return this.waitFor({controlType:"sap.m.GroupHeaderListItem",viewName:a,success:function(){e.assert.ok(true,"Master list is grouped")},errorMessage:"Master list is not grouped"})},theListShouldContainOnlyFormattedUnitNumbers:function(){var t=/^-?\d+\.\d{2}$/;return this.waitFor({controlType:"sap.m.ObjectListItem",viewName:a,success:function(i){e.assert.ok(i.every(function(e){return t.test(e.getNumber())}),"Numbers in ObjectListItems numbers are properly formatted")},errorMessage:"List has no entries which can be checked for their formatting"})},theListHeaderDisplaysZeroHits:function(){return this.waitFor({viewName:a,id:"masterPageTitle",autoWait:false,matchers:new o({name:"text",value:"<Products> (0)"}),success:function(){e.assert.ok(true,"The list header displays zero hits")},errorMessage:"The list header still has items"})},theListHasEntries:function(){return this.waitFor({viewName:a,id:"list",matchers:new n({name:"items"}),success:function(){e.assert.ok(true,"The list has items")},errorMessage:"The list had no items"})},theListShouldNotContainGroupHeaders:function(){function t(e){return e.getMetadata().getName()==="sap.m.GroupHeaderListItem"}return this.waitFor({viewName:a,id:"list",matchers:function(e){return!e.getItems().some(t)},success:function(){e.assert.ok(true,"Master list does not contain a group header although grouping has been removed.")},errorMessage:"Master list still contains a group header although grouping has been removed."})},theListShouldBeFilteredOnUnitNumber:function(){return this.theListShouldBeFilteredOnFieldUsingComparator("UnitPrice",100)},theListShouldBeSortedAscendingOnUnitNumber:function(){return this.theListShouldBeSortedAscendingOnField("UnitPrice")},theListShouldBeSortedAscendingOnName:function(){return this.theListShouldBeSortedAscendingOnField("ProductName")},theListShouldBeFilteredOnFieldUsingComparator:function(t,i){function s(e){var s=function(e){if(!e.getBindingContext()){return false}else{var s=e.getBindingContext().getProperty(t);if(s>i){return false}else{return true}}};return e.getItems().every(s)}return this.waitFor({viewName:a,id:"list",matchers:s,success:function(){e.assert.ok(true,"Master list has been filtered correctly for field '"+t+"'.")},errorMessage:"Master list has not been filtered correctly for field '"+t+"'."})},iShouldSeeTheList:function(){return this.waitFor({id:"list",viewName:a,success:function(t){e.assert.ok(t,"Found the object List")},errorMessage:"Can't see the master list."})},theListShowsOnlyObjectsWithTheSearchStringInTheirTitle:function(){this.waitFor({id:"list",viewName:a,matchers:new n({name:"items"}),check:function(e){var t=e.getItems()[0].getTitle(),i=e.getItems().every(function(e){return e.getTitle().indexOf(t)!==-1});return i},success:function(t){e.assert.ok(true,"Every item did contain the title")},errorMessage:"The list did not have items"})},theListShouldHaveAllEntries:function(){var t,i;this.waitFor(this.createAWaitForAnEntitySet({entitySet:"Products",success:function(e){t=e}}));return this.waitFor({id:"list",viewName:a,matchers:function(e){i=Math.min(e.getGrowingThreshold(),t.length);return new r({name:"items",length:i}).isMatching(e)},success:function(t){e.assert.strictEqual(t.getItems().length,i,"The growing list displays all items")},errorMessage:"List does not display all entries."})},iShouldSeeTheNoDataTextForNoSearchResults:function(){return this.waitFor({id:"list",viewName:a,success:function(t){e.assert.strictEqual(t.getNoDataText(),t.getModel("i18n").getProperty("masterListNoDataWithFilterOrSearchText"),"the list should show the no data text for search and filter")},errorMessage:"list does not show the no data text for search and filter"})},theHeaderShouldDisplayAllEntries:function(){return this.waitFor({id:"list",viewName:a,success:function(t){var i=t.getBinding("items").getLength();this.waitFor({id:"masterPageTitle",viewName:a,matchers:new o({name:"text",value:"<Products> ("+i+")"}),success:function(){e.assert.ok(true,"The master page header displays "+i+" items")},errorMessage:"The  master page header does not display "+i+" items."})},errorMessage:"Header does not display the number of items in the list"})},theListShouldHaveNoSelection:function(){return this.waitFor({id:"list",viewName:a,matchers:function(e){return!e.getSelectedItem()},success:function(t){e.assert.strictEqual(t.getSelectedItems().length,0,"The list selection is removed")},errorMessage:"List selection was not removed"})},theRememberedListItemShouldBeSelected:function(){this.waitFor({id:"list",viewName:a,matchers:function(e){return e.getSelectedItem()},success:function(t){e.assert.strictEqual(t.getTitle(),this.getContext().currentItem.title,"The list selection is incorrect.\nHint: If the master list shows integer numbers, use toString function to convert the second parameter to string")},errorMessage:"The list has no selection"})},theListShouldBeSortedAscendingOnField:function(t){function i(e){var i=null,s=function(e){if(!e.getBindingContext()){return false}var s=e.getBindingContext().getProperty(t);if(s===undefined){return false}if(!i||s>=i){i=s}else{return false}return true};return e.getItems().every(s)}return this.waitFor({viewName:a,id:"list",matchers:i,success:function(){e.assert.ok(true,"Master list has been sorted correctly for field '"+t+"'.")},errorMessage:"Master list has not been sorted correctly for field '"+t+"'."})}}}})});